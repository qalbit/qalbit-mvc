RewriteEngine On

############################################
# Security & hardening headers
############################################
<IfModule mod_headers.c>
    # -------------------------------------
    # HSTS – force HTTPS for future visits
    # Start with ~4 months; increase later
    # -------------------------------------
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    # -------------------------------------
    # Referrer Policy – limit what is sent
    # -------------------------------------
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # -------------------------------------
    # MIME sniffing protection
    # -------------------------------------
    Header always set X-Content-Type-Options "nosniff"

    # -------------------------------------
    # Clickjacking protection
    # -------------------------------------
    Header always set X-Frame-Options "SAMEORIGIN"

    # -------------------------------------
    # Permissions Policy – disable powerful features
    # -------------------------------------
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=()"

    # -------------------------------------
    # Content Security Policy
    #
    #  - No 'unsafe-inline' in script-src (you moved GTM, reCAPTCHA, Tawk, header JS to external files)
    #  - Allows:
    #       * GTM / GA
    #       * Google reCAPTCHA v3
    #       * Tawk.to widget
    #       * Google Fonts
    #  - Still allows inline *styles* for now via 'unsafe-inline' in style-src
    #    (because templates use inline style="" in places)
    # -------------------------------------
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com https://www.google.com https://www.gstatic.com https://embed.tawk.to https://*.tawk.to; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://*.tawk.to; img-src 'self' data: https://www.google-analytics.com https://www.googletagmanager.com https://www.google.com https://www.gstatic.com https://*.tawk.to https://tawk.link https://s3.amazonaws.com; font-src 'self' https://fonts.gstatic.com https://*.tawk.to; connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com https://www.google.com https://www.gstatic.com https://*.tawk.to wss://*.tawk.to; frame-src 'self' https://www.google.com https://recaptcha.google.com https://*.tawk.to; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'self'; upgrade-insecure-requests"
</IfModule>

############################################
# 1) Let /blog and /tools handle themselves
#    (WordPress in /blog, mini-site in /tools)
############################################
RewriteRule ^blog(/.*)?$ blog$1 [L]
RewriteRule ^tools(/.*)?$ tools$1 [L]

############################################
# 2) Serve any existing *file* at document root as-is
#    (css, js, images, favicon.ico, etc.)
############################################
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

############################################
# 3) New MVP static assets from /public/assets
#    /assets/css/app.css -> /public/assets/css/app.css
############################################
RewriteRule ^assets/(.+)$ public/assets/$1 [L]

############################################
# 4) Front controller for the custom MVP in /public
#    Everything else (not /public/, not /blog/, not /tools/, not a real file)
############################################
RewriteCond %{REQUEST_URI} !^/public/
RewriteRule ^ public/index.php [L]
